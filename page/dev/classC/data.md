# class C - 数据操作`0x08`



Note: 在未同步过时间时，设备将不会储存计步数据。



## 0x01.获取最近7天计步总数

| 数据格式 | byte0 | byte1-2 | byte3-4 | byte5-6 | ...  |
| ---- | ----- | ------- | ------- | ------- | ---- |
|      | 日期    | 当天步数    | 前一天步数   | 前两天步数   | ...  |

| 操作   | 接口索引 | 操作数  | 参数   |
| ---- | ---- | ---- | ---- |
| 获取   | 0x08 | 0x01 | 0x01 |
| 返回   | 0x08 | 0x01 | 计步数据 |

> 例：
> `APP->:fc,length=3,0x08,0x01,0x01(获取)`
> `->APP:fc,length=17,0x08,0x01,18(当月号数),0x34(当天数据低位),0x12(当天数据高位),0xZZ(前一天数据低位),0xYY(前一天数据高位)......`
>
> 以上返回数据表示，数据读取时为当月18号，当天数据为0x1234=4660步，一条命令可发送7天数据



## 0x02.设置每日计步目标

### 获取

| 操作 | 接口索引 | 操作数 | 参数          |
| ---- | -------- | ------ | ------------- |
| 获取 | 0x08     | 0x02   | 0x01(获取)    |
| 返回 | 0x08     | 0x02   | {P1,P2}(数值) |

> 例：
> `->MCU:fc,length=3,0x08,0x02,0x01`
> `MCU->:fc,length=4,0x08,0x02,0xE8,0x03`

### 设定

| 操作      | 接口索引 | 操作数 | 参数                     |
| --------- | -------- | ------ | ------------------------ |
| 设定      | 0x08     | 0x02   | 0x02(设定),{P1,P2}(数值) |
| 返回`ACK` | 0x08     | 0x02   | /                        |

> 例：
> `->MCU:fc,length=5,0x08,0x02,0x02,0xE8,0x03`设置计步目标为0x3E8=1000步
> `MCU->:ack`



## 0x03.获取最近一次心率测量结果

| 操作 | 接口索引 | 操作数 | 参数                             |
| ---- | -------- | ------ | -------------------------------- |
| 获取 | 0x08     | 0x03   | /                                |
| 返回 | 0x08     | 0x03   | {P1,P2,P3,P4}(时间戳),P5(心率值) |

> 例：
> `APP->:fc,length=3,0x08,0x03`
> `->APP:fc,length=7,0x08,0x03,{0x06,0xF2,0x3D,0x5B}时间戳,0x59(心率=89)`
>
> 以上返回数据表示，数据读取时`unix`时间戳为`0x5B3DF206`，心率为`0x59=89`步

Hint: 当返回心率为`0xFF=255`时，表示没有数据



## 0x10.请求获取详细数据

| 操作 | 接口索引 | 操作数 | 参数                             |
| ---- | -------- | ------ | -------------------------------- |
| 请求 | 0x08     | 0x10   | 0x01(请求),P0(数据类型)          |
| 返回 | 0x08     | 0x10   | P0(数据类型),{P1,P2}(数据包数量) |

请求获取详细数据，在获取数据包前必须请求。此请求会返回数据包的总数，并且会临时锁定所有对应数据类型的数据包，防止新产生的数据包造成干扰。当一分钟内没有获取详细数据时，会自动解除数据包锁定。

> 例：
> `->MCU:fc,length=4,0x08,0x10,0x01(请求),0x01(计步数据)`
> `MCU->:fc,length=5,0x08,0x10,0x01(计步数据),0xE8,0x03`返回数据包数为`0x3E8=1000`个数据包
>
> 例：
> `->MCU:fc,length=4,0x08,0x10,0x01(请求),0x02(心率数据)`
> `MCU->:fc,length=5,0x08,0x10,0x02(心率数据),0x10,0x01`返回数据包数为`0x110=272`个数据包



## 0x11.获取详细数据

| 操作 | 接口索引 | 操作数 | 参数                                                |
| ---- | -------- | ------ | --------------------------------------------------- |
| 请求 | 0x08     | 0x11   | 0x01(请求),P0(数据类型),{P1,P2}(索引),P3(burst模式) |
| 返回 | 0x08     | 0x11   | 数据包1[,数据包2]                                   |

获取数据包的内容。

计步数据包格式为`unix时间戳(4)-数据类型(1)-数据值(2)-扩展(1)`，其中，计步数据类型为`0x01`，时间戳与数据值表示在这个时间戳与上个时间戳之间产生的步数。

心率数据包格式为`unix时间戳(4)-数据类型(1)-数据值(1)`，其中，心率数据类型为`0x02`，时间戳与数据值表示在这个时间戳测量的心率。

睡眠数据包格式为`unix时间戳(4)-数据类型(1)-数据值(1)`，其中，睡眠数据类型为`0x03`，时间戳与数据值表示在这个时间戳之后的睡眠状态。

当`P3=0x01`时，表示启用`burst`模式，将一次返回两个数据包，分别为请求的索引和索引+1的数据包。否则，返回一个数据包。

> 例1：
> `->MCU:fc,length=5,0x08,0x11,0x01,0x05,0x00`普通模式获取第5个计步数据包
> `MCU->:fc,length=10,0x08,0x11,{0x06,0xF2,0x3D,0x5B}时间戳(0x5B3DF206),{0x01}(计步数据),{0x03,0xE8}(1000步),{0xFF}`

> 例2：
> `->MCU:fc,length=6,0x08,0x11,0x01,0x05,0x00,0x01`burst模式获取第5和第6个计步数据包
> `MCU->:fc,length=18,0x08,0x11,{0x06,0xF2,0x3D,0x5B}时间戳1(0x5B3DF206),{0x01}(计步数据),{0x03,0xE8}(1000步),{0xFF},{0xB0,0xF2,0x3D,0x5B}时间戳2(0x5B3DF2B0),{0x01}(计步数据),{0x02,0xE8}(999步),{0xFF}`
>
> 例3：
> `->MCU:fc,length=5,0x08,0x11,0x02(心率数据),0x02,0x00`普通模式获取第2个心率数据包
> `MCU->:fc,length=10,0x08,0x11,{0x06,0xF2,0x3D,0x5B}时间戳(0x5B3DF206),{0x02}(心率数据),{0x51}(心率81)`
>
> 例4：
> `->MCU:fc,length=6,0x08,0x11,0x02,0x04,0x00,0x01`burst模式获取第4和第5个心率数据包
> `MCU->:fc,length=14,0x08,0x11,{0x06,0xF2,0x3D,0x5B}时间戳1(0x5B3DF206),{0x02}(心率数据),{0x51}(心率81),{0xB0,0xF2,0x3D,0x5B}时间戳2(0x5B3DF2B0),{0x02}(心率数据),{0x53}(心率83)`

当使用`burst`模式获取到超出范围的数据包时，数据类型会填充为`0xFF`

Hint:  第`1`个数据包为最新的数据包。

Hint:  一种建议的同步数据方式是，从第`1`包开始往后同步，直到遇到重复（同步过）的`时间戳`或者同步完了所有数据包为止。当遇到重复的`时间戳`后，再检查最后一个数据包的时间戳是否已经重复（同步过），如果没有，则从最后一个数据包往前同步，直到遇到重复（同步过）为止。

Hint:  当需要计算有多少数据包没有同步时，可以使用二分法读取，由于数据包一般不会储存超过`2k`个，所以至多`11`次读取便可以确定最后同步的数据包的位置。





## 0x80.APP拍照模式

### 进入（重置计时）

| 操作   | 接口索引 | 操作数  | 参数          |
| ---- | ---- | ---- | ----------- |
| 进入   | 0x08 | 0x80 | 0x01(进入/重置) |
| 返回   | 0x08 | 0x80 | /           |

> 例：
> `->MCU:fc,length=3,0x08,0x80,0x01`
> `MCU->:ack`

### 退出

| 操作   | 接口索引 | 操作数  | 参数       |
| ---- | ---- | ---- | -------- |
| 退出   | 0x08 | 0x80 | 0x00(退出) |
| 返回   | 0x08 | 0x80 | /        |

> 例：
> `->MCU:fc,length=3,0x08,0x80,0x00`
> `MCU->:ack`

### 拍摄

| 操作   | 接口索引 | 操作数  | 参数       |
| ---- | ---- | ---- | -------- |
| 拍摄   | 0x08 | 0x80 | 0x08(拍摄) |
| 确认   | 0x08 | 0x80 | /        |

> 例：
> `MCU->:fc,length=3,0x08,0x80,0x08`
> `->MCU:ack`

